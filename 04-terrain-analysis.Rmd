```{r echo=FALSE}
yml_content <- yaml::read_yaml("chapterauthors.yml")
author <- yml_content[["lab3shortname"]][["author"]]
```
# Terrain Analysis {#terrain}

Written by
```{r results='asis', echo=FALSE}
cat(author)
```

## Lab Overview {-}

A Digital Elevation Model (DEM) is a representation of the Earth's terrain, including mountains, valleys, rivers and other topographic features. They are typically created using remote sensing technologies including radar and lidar (Light Detection and Ranging) that measure elevation data points across a landscape. Typically these data points are organized into raster format, where each raster cell is representative of elevation within a pixel. DEMs are used in a range of applications including cartography, hydrology and geology. 

In this lab, you will use a DEM and Hydrology toolset in ArcGIS Pro to map stream networks and watersheds within critical salmon spawning habitat. You will then use data from CLimate NA to understand how change in temperature and precipitation may impact future water flow in this watershed. 

``` {r, echo=FALSE, fig.align = 'center'}
knitr::include_graphics('images/04/04-terrain.jpg')
```

------------------------------------------------------------------------

## Learning Objectives {-}

- Understand how data is represented in a DEM

- Learn how to derive slope, aspect using raster focal calculations

- Use the Hydrology toolbox to map stream networks and watershed boundaries

------------------------------------------------------------------------

## Deliverables {-}

------------------------------------------------------------------------

## Data {-}

- DEM of the XXXXX region

------------------------------------------------------------------------

## Task 1: Preparing the DEM {-}

**Step 1:** Create a new ArcGIS Project name it Lab4 and save it to the default directory. Import the **Nahmint_DTM.tif** and examine the Source information (right-click on the layer in the Catalog pane). 

``` {r, echo=FALSE, fig.align = 'center'}
knitr::include_graphics('images/04/04-nahmint.jpg')
```

##### Q1: What is the Projected Coordinate System and spatial resolution of the data? {.unnumbered}

##### Q2: What is the Pixel Type and Pixel Depth? How many possible values can be represented by this data? (Report answer as an exponent.) {.unnumbered}

##### Q3: What is the difference between a signed and unsigned integer? Which would represent elevation best and why? {.unnumbered}

**Step 2:** First, we will use the **Fill** tool to remove any sinks from the DEM. Sinks are small imperfections in the DEM that create areas where water cannot flow out of. The image below shows the side profile of sink and how its gets filled by the Fill tool. If sinks are not eliminated, water flow can get trapped within these depressions, leading to unrealistic pooling of water and incorrect delineation of watershed boundaries. 

``` {r, echo=FALSE, fig.align = 'center'}
knitr::include_graphics('images/04/04-sink.jpg')
```
Navigate to Analysis > Tools > Fill (Spatial Analyst). 

- Input Surface Raster: Nahmint_DTM.tiff
- Output Surface Raster: Nahmint_fill
- Z limit: leave blank

Save the output to the default file path (in your ArcMap project). 

The Z-limit represents the minimum depth of sinks that will be filled. For example, if it is set to 10m then only sinks deeper than 10m will be filled. For now leave this field blank, this will fill all sinks in the data. 

##### Q4: Why might you want to set a specific z-value? {.unnumbered} 

------------------------------------------------------------------------

## Task 2: Identifying Stream Networks {-}

**Step 1:** Next we will use the **Flow Direction** tool to to calculate the direction of water flow across the landscape. 

There are three flow modelling algorithms, but we will use the simplest: **D8**. In this model water will flow from one cell its **steepest downslope neighbour**. The cell will then be assigned a value based on which of its 8 neightbours water will flow into.

##### Q5: The following raster shows elevation above sea level. What is the flow direction from the centre cell?  Report your answer in terms of cardinal direction (North, South, Northwest etc) {.unnumbered}

Use the ArcGis help page to answer to following question: https://pro.arcgis.com/en/pro-app/latest/tool-reference/spatial-analyst/flow-direction.htm

##### Q6: If a cell is assigned a Flow Direction value of 32, what cardinal direction is water flowing out of the cell? {.unnumbered} 

``` {r, echo=FALSE, fig.align = 'center', out.width = "40%"}
knitr::include_graphics("images/04/04-flowDirJPG.JPG")
```

Navigate to Tools > Search **Flow Direction**

- Input surface raster: **Nahmint_fill**
- Output flow direction raster: **Nahmint_FlowDir**
- Flow Direction Type: D8
- Leave the rest blank/unchecked

Click Run. You should now have something like the following:

##### Q7: For the areas marked A and B, approximately what direction is water flowing? {.unnumbered} 

``` {r, echo=FALSE, fig.align = 'center'}
knitr::include_graphics("images/04/04-flowDir2.JPG")
```

Step 2: Flow Accumulation

Step 3: Stream ordering

Step 4: Stream to feature tool to vectorize stream networks

------------------------------------------------------------------------

## Task 3: Mapping Watersheds {-}

Step 1: Snap to pour point

How does changing the location of the pour point impact the results? 

Step 2: Watershed tool

Step 3: Vectorize/visualize watersheds

------------------------------------------------------------------------

## Task 4: Analyze watersheds {-}

Step 1: Import temperature and precipitation trends from Climate NA

Step 2: Summarize climate change variables by watershed

Which watersheds have the greatest change in temperature/precipitation? 

How might these changes impact the stream network you identified in Task 2? 
